const express = require("express");
const bodyParser = require("body-parser");
const app = express();
const cors = require("cors")
const bcrypt = require("bcryptjs")
const Camisetas = require("./models/camisetas")
const PORT = process.env.PORT || 3004
const mongoose = require("mongoose");
const stripe = require("stripe")("sk_test_51IXWAzI065aszrHxziqFhlIvzUnV8kYKL1GOulI7Xp0EvAFm6aAIFdo75wuhl4CqByb92fGeryTh9oHrP4jTVchN00SNCKdTzb")
const uuid = require("uuid")

//middlewares
app.use(express.json())
app.use(bodyParser.urlencoded({extended:true}))
app.use(cors())
app.use((req, res, next)=>{
    res.header("Access-Control-Allow-Origin", "*")
    app.use(cors())
    next()
})




//payment route

app.post("/payment", cors(), async (req, res)=>{
    let {name,amount, id, cpf } = req.body
    try{
        const payment = await stripe.paymentIntents.create({
            amount,
            currency:"BRL",
            description:name,
            payment_method:id,
            confirm:true
        })
        console.log("Payment", payment)
        res.json({
            message:"Paymeny Success",
            success:true
        })
    }catch(error){
        console.log("error",error)
        res.json({
            message:"payment Failed",
            success:false
        })
    }
})



